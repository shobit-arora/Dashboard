<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Arora Family Calendar</title>

<style>
html,body{
  margin:0;
  height:100%;
  overflow:hidden;
  background:#0b0f17;
  color:#fff;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
}

.wrap{
  height:100vh;
  padding:16px;
  box-sizing:border-box;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.header{
  background:#111827;
  border-radius:16px;
  padding:14px 20px;
  display:grid;
  grid-template-columns:auto 1fr auto;
  align-items:center;
}

.header img{
  height:48px;
  opacity:0.9;
}

.titleBlock{
  text-align:center;
}

.title{
  font-size:28px;
  font-weight:800;
}

.dt{
  display:flex;
  justify-content:space-between;
  font-size:20px;
  font-weight:700;
  margin-top:6px;
}

.main{
  flex:1;
  display:grid;
  grid-template-columns:34% 66%;
  gap:12px;
  min-height:0;
}

.card{
  background:#111827;
  border-radius:16px;
  padding:12px;
}

.left{
  display:flex;
  flex-direction:column;
  gap:12px;
}

.photoBox{
  height:clamp(200px, 28vh, 300px);
  background:#000;
  border-radius:14px;
  overflow:hidden;
}

.photoBox img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.wxNow{
  display:flex;
  align-items:center;
  gap:12px;
}

.wxIcon svg{
  width:44px;
  height:44px;
}

.wxTemp{
  font-size:28px;
  font-weight:800;
}

.wxCond{
  font-size:14px;
  opacity:.85;
}

.forecastRow{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:8px;
  margin-top:10px;
  font-size:14px;
}

.forecastDay{
  text-align:center;
}

.calendar{
  height:100%;
  border-radius:16px;
  overflow:hidden;
}

.calendar iframe{
  width:100%;
  height:100%;
  border:0;
  filter:invert(1) hue-rotate(180deg) contrast(1.05);
}

.miniIcon svg{width:28px;height:28px; display:block; margin:0 auto;}
</style>
</head>

<body>
<div class="wrap">

  <div class="header">
    <img src="om 1.png" alt="Om left">
    <div class="titleBlock">
      <div class="title">Arora Family Calendar</div>
      <div class="dt">
        <div id="time"></div>
        <div id="date"></div>
      </div>
    </div>
    <img src="om 1.png" alt="Om right">
  </div>

  <div class="main">
    <div class="left">

      <div class="card photoBox">
        <img id="photo">
      </div>

      <div class="card">
        <strong>Houston Weather</strong>

        <div class="wxNow">
          <div class="wxIcon" id="wxIcon"></div>
          <div>
            <div class="wxTemp" id="wxTemp">--°F</div>
            <div class="wxCond" id="wxCond">Loading…</div>
          </div>
        </div>

        <div class="forecastRow" id="forecast"></div>
      </div>

    </div>

    <div class="calendar">
      <iframe
        src="https://calendar.google.com/calendar/embed?src=shashilandshobit%40gmail.com&ctz=America%2FChicago&mode=MONTH&showTitle=0&showTabs=0">
      </iframe>
    </div>
  </div>

</div>

<script>
/* CLOCK */
function tick(){
  const now=new Date();
  time.textContent=now.toLocaleTimeString([], {hour:'numeric',minute:'2-digit'});
  date.textContent=now.toLocaleDateString([], {weekday:'long',month:'short',day:'numeric'});
}
setInterval(tick,1000); tick();

/* PHOTOS */
const PHOTOS=[
  "https://picsum.photos/1600/900?1",
  "https://picsum.photos/1600/900?2",
  "https://picsum.photos/1600/900?3",
  "https://picsum.photos/1600/900?4",
  "https://picsum.photos/1600/900?5"
];

let p=0;
function showNext(){
  photo.src=PHOTOS[p%PHOTOS.length];
  p++;
}
showNext();
setInterval(showNext,8000);

/* WEATHER (weather.gov via api.weather.gov) + 6hr auto refresh */
setTimeout(()=>location.reload(), 6*60*60*1000);

const LAT = 29.7604, LON = -95.3698;

/* Simple SVG icon set (monochrome, matches dark theme) */
function svgSun(){return `<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <circle cx="12" cy="12" r="4"/><path d="M12 2v3M12 19v3M4 12h3M17 12h3M5 5l2 2M17 17l2 2M5 19l2-2M17 7l2-2"/>
</svg>`;}
function svgMoon(){return `<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M21 12.8A8.5 8.5 0 1 1 11.2 3a6.5 6.5 0 0 0 9.8 9.8Z"/>
</svg>`;}
function svgCloud(){return `<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M7 18h10a4 4 0 0 0 .7-7.94A6 6 0 0 0 6.2 12.2 3.5 3.5 0 0 0 7 18Z"/>
</svg>`;}
function svgPartly(){return `<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M7 18h10a4 4 0 0 0 .7-7.94A6 6 0 0 0 6.2 12.2 3.5 3.5 0 0 0 7 18Z"/>
  <circle cx="8" cy="9" r="2"/><path d="M8 3v2M8 13v2M3 9h2M11 9h2M4.5 5.5l1.4 1.4M10.1 11.1l1.4 1.4M4.5 12.5l1.4-1.4M10.1 6.9l1.4-1.4"/>
</svg>`;}
function svgRain(){return `<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M7 15h10a4 4 0 0 0 .7-7.94A6 6 0 0 0 6.2 9.2 3.5 3.5 0 0 0 7 15Z"/>
  <path d="M8 19l-1 2M12 19l-1 2M16 19l-1 2"/>
</svg>`;}
function svgStorm(){return `<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M7 14h10a4 4 0 0 0 .7-7.94A6 6 0 0 0 6.2 8.2 3.5 3.5 0 0 0 7 14Z"/>
  <path d="M13 14l-3 5h3l-1 3 4-6h-3l1-2Z"/>
</svg>`;}
function svgSnow(){return `<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M7 14h10a4 4 0 0 0 .7-7.94A6 6 0 0 0 6.2 8.2 3.5 3.5 0 0 0 7 14Z"/>
  <path d="M8 18h0M12 18h0M16 18h0"/>
  <path d="M8 18l0 0M12 18l0 0M16 18l0 0"/>
  <path d="M8 18l-1 1M8 18l1 1M12 18l-1 1M12 18l1 1M16 18l-1 1M16 18l1 1"/>
</svg>`;}
function svgSleet(){return `<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M7 14h10a4 4 0 0 0 .7-7.94A6 6 0 0 0 6.2 8.2 3.5 3.5 0 0 0 7 14Z"/>
  <path d="M9 18l-1 2M13 18l-1 2"/>
  <circle cx="16.5" cy="19.5" r="1"/>
</svg>`;}
function svgWind(){return `<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M3 8h10a3 3 0 1 0-3-3"/><path d="M3 12h14a3 3 0 1 1-3 3"/><path d="M3 16h8"/>
</svg>`;}
function svgFog(){return `<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M7 12h10a4 4 0 0 0 .7-7.94A6 6 0 0 0 6.2 6.2 3.5 3.5 0 0 0 7 12Z"/>
  <path d="M4 16h16M6 19h12"/>
</svg>`;}

function iconFromText(txt, isDay=true){
  const t=(txt||"").toLowerCase();
  const thunder = t.includes("thunder");
  const snow = t.includes("snow") || t.includes("blizzard");
  const sleet = t.includes("sleet") || t.includes("ice") || t.includes("freezing") || t.includes("hail");
  const rain = t.includes("rain") || t.includes("shower") || t.includes("drizzle");
  const fog = t.includes("fog") || t.includes("haze") || t.includes("smoke") || t.includes("mist");
  const wind = t.includes("wind") || t.includes("breezy") || t.includes("gust");
  const overcast = t.includes("overcast");
  const cloudy = t.includes("cloud");
  const partly = t.includes("partly") || t.includes("mostly sunny") || t.includes("mostly clear");

  if(thunder) return svgStorm();
  if(snow) return svgSnow();
  if(sleet) return svgSleet();
  if(rain) return svgRain();
  if(fog) return svgFog();
  if(wind && !rain && !snow && !sleet) return svgWind();
  if(partly) return svgPartly();
  if(overcast || cloudy) return svgCloud();
  return isDay ? svgSun() : svgMoon();
}

function renderForecastCards(dayCards){
  // dayCards: [{dow, hi, lo, text, svg}]
  forecast.innerHTML = dayCards.map(dc => `
    <div class="forecastDay">
      <div class="dow">${dc.dow}</div>
      <div class="miniIcon">${dc.svg}</div>
      <div class="temps">${dc.hi}° / ${dc.lo}°</div>
      <div class="miniCond">${dc.text}</div>
    </div>
  `).join("");
}

function parseDailyFromNWS(periods){
  // Build: today + next 4 days
  const byDate = new Map(); // yyyy-mm-dd -> {dow, hi, lo, textDay, textNight, isDayIconText}
  for(const p of periods){
    const d = new Date(p.startTime);
    const key = d.toISOString().slice(0,10);
    if(!byDate.has(key)){
      byDate.set(key, {
        dateKey:key,
        dateObj:d,
        dow:d.toLocaleDateString([], {weekday:'short'}),
        hi:null, lo:null,
        dayText:null, nightText:null,
        dayIsDay:true
      });
    }
    const rec = byDate.get(key);
    if(p.isDaytime){
      rec.hi = rec.hi ?? p.temperature;
      rec.dayText = rec.dayText ?? p.shortForecast;
    } else {
      rec.lo = rec.lo ?? p.temperature;
      rec.nightText = rec.nightText ?? p.shortForecast;
    }
  }

  const sorted = Array.from(byDate.values()).sort((a,b)=>a.dateKey.localeCompare(b.dateKey));

  // ensure today is first (in case API returns earlier entries)
  const todayKey = new Date().toISOString().slice(0,10);
  const startIdx = Math.max(0, sorted.findIndex(x=>x.dateKey===todayKey));
  const slice = sorted.slice(startIdx, startIdx+5);

  // Fill missing hi/lo using whichever exists
  return slice.map(r=>{
    const text = r.dayText || r.nightText || "—";
    const hi = (r.hi!=null)? r.hi : (r.lo!=null ? r.lo : "--");
    const lo = (r.lo!=null)? r.lo : (r.hi!=null ? r.hi : "--");
    return {
      dow: r.dow,
      hi: Math.round(hi),
      lo: Math.round(lo),
      text,
      svg: iconFromText(text, true)
    };
  });
}

async function loadWeatherGov(){
  try{
    const pt = await fetch(`https://api.weather.gov/points/${LAT},${LON}`, {headers:{'Accept':'application/geo+json'}});
    if(!pt.ok) throw new Error("points failed");
    const ptj = await pt.json();
    const forecastUrl = ptj.properties && ptj.properties.forecast;
    const hourlyUrl = ptj.properties && ptj.properties.forecastHourly;
    if(!forecastUrl || !hourlyUrl) throw new Error("missing forecast urls");

    const [dailyRes, hourlyRes] = await Promise.all([
      fetch(forecastUrl, {headers:{'Accept':'application/geo+json'}}),
      fetch(hourlyUrl, {headers:{'Accept':'application/geo+json'}})
    ]);
    if(!dailyRes.ok || !hourlyRes.ok) throw new Error("forecast fetch failed");

    const daily = await dailyRes.json();
    const hourly = await hourlyRes.json();

    const cur = (hourly.properties && hourly.properties.periods && hourly.properties.periods[0]) || null;
    if(cur){
      wxTemp.textContent = `${Math.round(cur.temperature)}°F`;
      wxCond.textContent = cur.shortForecast || "—";
      wxIcon.innerHTML = iconFromText(cur.shortForecast, true);
    } else {
      wxTemp.textContent="--°F"; wxCond.textContent="—"; wxIcon.innerHTML=svgCloud();
    }

    const periods = (daily.properties && daily.properties.periods) || [];
    const days = parseDailyFromNWS(periods);
    renderForecastCards(days);
  } catch(e){
    // Fallback to Open-Meteo if weather.gov blocks the request (static GitHub Pages can’t add custom headers like User-Agent)
    console.warn("weather.gov failed, falling back to Open-Meteo", e);
    loadOpenMeteoFallback();
  }
}

function loadOpenMeteoFallback(){
  fetch("https://api.open-meteo.com/v1/forecast?latitude=29.7604&longitude=-95.3698&current=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,weather_code&temperature_unit=fahrenheit&timezone=America/Chicago")
  .then(r=>r.json())
  .then(d=>{
    wxTemp.textContent=Math.round(d.current.temperature_2m)+"°F";
    wxCond.textContent="—";
    wxIcon.innerHTML=svgCloud();

    // today + next 4
    const start = 0;
    const cards = [];
    for(let i=start;i<Math.min(start+5, d.daily.time.length);i++){
      const dow = new Date(d.daily.time[i]).toLocaleDateString([], {weekday:'short'});
      const code = d.daily.weather_code ? d.daily.weather_code[i] : null;
      const text = (code===0?"Clear": (code!=null && code<4 ? "Partly Cloudy":"Overcast"));
      cards.push({
        dow,
        hi: Math.round(d.daily.temperature_2m_max[i]),
        lo: Math.round(d.daily.temperature_2m_min[i]),
        text,
        svg: iconFromText(text, true)
      });
    }
    renderForecastCards(cards);
  });
}

loadWeatherGov();

</script>
</body>
</html>
